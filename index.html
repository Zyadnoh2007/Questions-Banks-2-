<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Nursing Platform Pro</title>
  <link rel="stylesheet" href="style.css">
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
  <!-- ููุชุจุฉ ููุฃููููุงุช -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>

  <!-- ุดุฑูุท ุงูุฅุนูุงูุงุช ุงูุซุงุจุช -->
  <div id="news-ticker" class="news-ticker" style="display:none;">
    <div class="ticker-content" id="ticker-text">๐ข ุฃููุงู ุจูู ูู ุงูููุตุฉ ุงูุชุนููููุฉ...</div>
  </div>

  <!-- Auth Modal (New Split System) -->
  <div id="auth-modal" class="modal-overlay">
    <div class="modal-box auth-box">
      <div class="auth-tabs">
        <button class="auth-tab-btn active" onclick="switchAuthMode('login')">ุชุณุฌูู ุฏุฎูู</button>
        <button class="auth-tab-btn" onclick="switchAuthMode('register')">ุชุณุฌูู ุฌุฏูุฏ</button>
      </div>

      <!-- Login Form -->
      <div id="login-form" class="auth-form">
        <h3>ุฃููุงู ุจุนูุฏุชู ูุง ุจุทู ๐</h3>
        <p>ุงุฏุฎู ุงุณู ุงููุณุชุฎุฏู (User ID) ูููุชุงุจุนุฉ</p>
        <input type="text" id="login-username" placeholder="username (English only)" dir="ltr" />
        <p id="login-msg" class="error-msg"></p>
        <button class="start-btn" onclick="loginUser()">๐ ุฏุฎูู</button>
      </div>

      <!-- Register Form -->
      <div id="register-form" class="auth-form" style="display:none;">
        <h3>ุฅูุดุงุก ุญุณุงุจ ุฌุฏูุฏ ๐</h3>
        <input type="text" id="reg-fullname" placeholder="ุงูุงุณู ุงูุซูุงุซู (ุจุงูุนุฑุจู)" />
        <input type="text" id="reg-username" placeholder="ุงุณู ุงููุณุชุฎุฏู (ุฅูุฌููุฒู - ูุฑูุฏ)" dir="ltr" />
        <p style="font-size:0.8rem; color:gray; margin-top:-10px; margin-bottom:10px;">* ุงุณู ุงููุณุชุฎุฏู ูู ููุชุงุญ ุฏุฎูููุ ุงุญูุธู ุฌูุฏุงู.</p>
        <p id="reg-msg" class="error-msg"></p>
        <button class="start-btn" onclick="registerUser()">๐พ ุชุณุฌูู ูุญูุธ</button>
      </div>
    </div>
  </div>

  <!-- Admin Login -->
  <div id="admin-login-modal" class="modal-overlay" style="display: none;">
    <div class="modal-box">
      <h2>ุฏุฎูู ุงููุดุฑููู ๐</h2>
      <input type="password" id="admin-password-input" placeholder="ูููุฉ ุงููุฑูุฑ..." />
      <div class="modal-buttons">
          <button class="start-btn" onclick="checkAdminPassword()">ุฏุฎูู</button>
          <button class="back-btn" onclick="closeAdminLogin()">ุฅูุบุงุก</button>
      </div>
    </div>
  </div>

  <div class="container">
    <div class="header">
      <div class="header-controls">
          <button id="theme-toggle" class="icon-btn" title="ุชุบููุฑ ุงููุถุน"><i class="fas fa-moon"></i></button>
          <button onclick="logout()" class="icon-btn logout-icon" title="ุชุณุฌูู ุฎุฑูุฌ"><i class="fas fa-sign-out-alt"></i></button>
          <button onclick="openDashboard()" class="icon-btn dashboard-icon" title="ุฅุญุตุงุฆูุงุชู"><i class="fas fa-chart-pie"></i></button>
          <button onclick="openAdminLogin()" class="icon-btn admin-icon" title="ููุญุฉ ุงููุดุฑููู"><i class="fas fa-user-shield"></i></button>
      </div>
      
      <h1 id="site-title">ููุตุฉ ุงูุชูุฑูุถ ุงูุชุนููููุฉ</h1>
      <p id="welcome-message">ุฌุงุฑู ุงูุชุญููู...</p>
    </div>

    <!-- Honor Board (Optional) -->
    <div id="honor-board" class="honor-board" style="display:none;">
        <h3>๐ ููุญุฉ ุงูุดุฑู - ุงูุฃูุงุฆู ๐</h3>
        <div id="top-students-list" class="top-students-grid">
            <!-- ุณูุชู ุชุนุจุฆุชูุง ุจุงูุฌุงูุงุณูุฑูุจุช -->
        </div>
    </div>

    <!-- Main Content -->
    <div id="main-nav" class="tab-container"></div>
    <div id="source-selection" class="source-container"></div>
    <div id="quiz-list-area" class="tab-content active" style="display:none;">
        <button class="back-btn" onclick="backToSources()">โ ุชุบููุฑ ุงููุตุฏุฑ</button>
        <h3 id="source-title-display" style="text-align:center; color:var(--primary-color);"></h3>
        <div id="dynamic-cards-container" class="cards-grid"></div>
    </div>

    <!-- Student Dashboard -->
    <div id="dashboard-view" class="dashboard-view" style="display:none;">
        <h2 class="quiz-title">ูููู ุงูุดุฎุตู ๐</h2>
        <div class="stats-grid">
            <div class="stat-card"><div class="stat-icon">๐</div><div class="stat-info"><span id="total-quizzes-taken">0</span><p>ูููุฒุงุช</p></div></div>
            <div class="stat-card"><div class="stat-icon">๐ฏ</div><div class="stat-info"><span id="total-accuracy">0%</span><p>ุงููุณุชูู</p></div></div>
            <div class="stat-card"><div class="stat-icon">๐ค</div><div class="stat-info"><span id="user-display-id">-</span><p>ุงุณู ุงููุณุชุฎุฏู</p></div></div>
        </div>
        <div class="history-table-container">
            <table id="history-table">
                <thead><tr><th>ุงูุงูุชุญุงู</th><th>ุงูุฏุฑุฌุฉ</th><th>ุงูุญุงูุฉ</th></tr></thead>
                <tbody id="history-table-body"></tbody>
            </table>
        </div>
        <button class="start-btn go-back" onclick="closeDashboard()" style="margin-top:20px;">ุงูุนูุฏุฉ ููุฑุฆูุณูุฉ</button>
    </div>

    <!-- Admin Dashboard -->
    <div id="admin-dashboard-view" class="dashboard-view admin-panel" style="display:none;">
        <div class="admin-header">
            <h2 style="color:white; margin:0;"><i class="fas fa-cogs"></i> ููุญุฉ ุงูุชุญูู</h2>
            <button class="start-btn" onclick="closeAdminDashboard()" style="background:rgba(255,255,255,0.2); width:auto;">ุฎุฑูุฌ</button>
        </div>

        <div class="tab-container admin-tabs">
            <button class="tab-btn active" onclick="switchAdminTab('users')"><i class="fas fa-users"></i> ุงูุทูุงุจ</button>
            <button class="tab-btn" onclick="switchAdminTab('results')"><i class="fas fa-poll"></i> ุงููุชุงุฆุฌ ูุงูุชูุงุฑูุฑ</button>
            <button class="tab-btn" onclick="switchAdminTab('content')"><i class="fas fa-edit"></i> ุงููุญุชูู (Hybrid)</button>
            <button class="tab-btn" onclick="switchAdminTab('settings')"><i class="fas fa-sliders-h"></i> ุงูุฅุนุฏุงุฏุงุช</button>
        </div>

        <!-- 1. Users Management -->
        <div id="admin-tab-users" class="admin-tab-content">
            <div class="filter-container">
                <input type="text" id="users-search" placeholder="ุจุญุซ ุจุงูุงุณู ุฃู ุงูููุฒุฑ..." onkeyup="filterUsersTable()">
                <button class="start-btn" onclick="fetchAdminUsers()" style="width:auto;"><i class="fas fa-sync"></i> ุชุญุฏูุซ</button>
            </div>
            <div class="history-table-container">
                <table id="users-table">
                    <thead><tr><th>ุงูุงุณู ุงูุซูุงุซู</th><th>ุงุณู ุงููุณุชุฎุฏู</th><th>ุชุงุฑูุฎ ุงูุงูุถูุงู</th><th>ุงูุญุงูุฉ</th><th>ุฅุฌุฑุงุกุงุช</th></tr></thead>
                    <tbody id="users-table-body"></tbody>
                </table>
            </div>
        </div>

        <!-- 2. Results & Reports -->
        <div id="admin-tab-results" class="admin-tab-content" style="display:none;">
            <div class="filter-container">
                <input type="text" id="results-search" placeholder="ุจุญุซ ุนู ุทุงูุจ..." onkeyup="filterResultsAccordion()">
                <div class="btn-group">
                    <button class="start-btn" onclick="printReport('all')" style="background:#22c55e; width:auto;"><i class="fas fa-print"></i> ุชูุฑูุฑ ุดุงูู</button>
                    <button class="start-btn" onclick="exportToExcel()" style="background:#10b981; width:auto;"><i class="fas fa-file-excel"></i> Excel</button>
                </div>
            </div>
            <div id="results-accordion" class="accordion-container">
                <!-- ุณูุชู ููุคู ุฏููุงููููุงู -->
                <p style="text-align:center; padding:20px;">ุฌุงุฑู ุชุญููู ุงููุชุงุฆุฌ...</p>
            </div>
        </div>

        <!-- 3. Content (The Hybrid System) -->
        <div id="admin-tab-content" class="admin-tab-content" style="display:none;">
            <!-- ุฅุถุงูุฉ ูุงุฏุฉ/ูุตุฏุฑ (ููุง ูู) -->
            <div class="content-controls-row">
                 <div class="control-group">
                    <h4>ุฅุถุงูุฉ ูุงุฏุฉ</h4>
                    <input type="text" id="new-subject-name" placeholder="ุงุณู ุงููุงุฏุฉ">
                    <input type="text" id="new-subject-id" placeholder="ID" style="width:80px">
                    <button onclick="addNewSubject()" class="mini-btn">+</button>
                 </div>
                 <div class="control-group">
                    <h4>ุฅุถุงูุฉ ูุตุฏุฑ</h4>
                    <select id="source-subject-select"></select>
                    <input type="text" id="new-source-name" placeholder="ุงุณู ุงููุตุฏุฑ">
                    <input type="text" id="new-source-id" placeholder="ID" style="width:80px">
                    <button onclick="addNewSource()" class="mini-btn">+</button>
                 </div>
            </div>

            <div class="hybrid-editor-container">
                <div class="editor-header">
                    <h3><i class="fas fa-brain"></i> ุตุงูุน ุงูุงูุชุญุงูุงุช (ุงููุธุงู ุงููุฌูู)</h3>
                    <div class="exam-meta">
                        <select id="exam-subject-select" onchange="updateSourceSelect()"></select>
                        <select id="exam-source-select"></select>
                        <input type="text" id="new-exam-title" placeholder="ุนููุงู ุงูุงูุชุญุงู">
                        <select id="exam-timer-type">
                            <option value="open">ููุช ููุชูุญ</option>
                            <option value="limit">ููุช ูุญุฏุฏ</option>
                        </select>
                        <input type="number" id="exam-time-val" placeholder="ุฏูููุฉ" style="display:none; width:70px;">
                    </div>
                </div>

                <!-- ุดุฑูุท ุงูุฃุฏูุงุช -->
                <div class="toolbar">
                    <button onclick="addQuestionCard()" class="tool-btn"><i class="fas fa-plus-circle"></i> ุณุคุงู ุฌุฏูุฏ (ูุงุฑุช)</button>
                    <button onclick="openSmartImport()" class="tool-btn magic-btn"><i class="fas fa-magic"></i> ุงุณุชูุฑุงุฏ ุฐูู (ูุณุฎ ูุต)</button>
                    <span id="questions-count-badge">0 ุณุคุงู</span>
                </div>

                <!-- ุงูุญุงููุฉ ุงููุฑุฆูุฉ ูููุฑูุช (Visual Builder) -->
                <div id="builder-container" class="builder-area">
                    <p class="empty-state">ูู ูุชู ุฅุถุงูุฉ ุฃุณุฆูุฉ ุจุนุฏ. ุงุจุฏุฃ ุจุฅุถุงูุฉ ูุงุฑุช ุฃู ุงูุงุณุชูุฑุงุฏ ูู ูุต.</p>
                </div>

                <div class="editor-footer">
                    <button onclick="saveHybridExam()" class="start-btn save-exam-btn">๐พ ุญูุธ ุงูุงูุชุญุงู ุงูููุงุฆู</button>
                </div>
            </div>

             <!-- Delete Section -->
             <div class="delete-section" style="margin-top:30px;">
                <h3>๐๏ธ ุญุฐู ุงููุญุชูู</h3>
                <div class="delete-controls">
                    <select id="delete-type-select" onchange="updateDeleteDropdown()">
                        <option value="none">-- ุงุฎุชุฑ --</option>
                        <option value="quiz">ุงูุชุญุงู</option>
                        <option value="subject">ูุงุฏุฉ</option>
                        <option value="source">ูุตุฏุฑ</option>
                    </select>
                    <select id="delete-item-select" style="display:none;"></select>
                    <button class="btn-danger" onclick="deleteSelectedItem()">ุญุฐู ููุงุฆู</button>
                </div>
            </div>
        </div>

        <!-- 4. Settings -->
        <div id="admin-tab-settings" class="admin-tab-content" style="display:none;">
            <div class="admin-setting-card">
                <h3>๐ข ุดุฑูุท ุงูุฅุนูุงูุงุช</h3>
                <textarea id="setting-announcement" rows="2" placeholder="ุงูุชุจ ุงูุฅุนูุงู ููุง..."></textarea>
                <button onclick="saveSettings('announcement')" class="mini-btn" style="margin-top:10px;">ุญูุธ ุงูุฅุนูุงู</button>
            </div>

            <div class="admin-setting-card">
                <h3>๐ ููุญุฉ ุงูุดุฑู</h3>
                <label class="switch-container">
                    <input type="checkbox" id="setting-honor-toggle">
                    <span class="slider round"></span>
                    <span class="switch-text">ุชูุนูู ููุญุฉ ุงูุดุฑู (ุฃุนูู 5 ุทูุงุจ)</span>
                </label>
                <button onclick="saveSettings('honor')" class="mini-btn" style="margin-top:10px;">ุญูุธ ุงูุฅุนุฏุงุฏ</button>
            </div>
        </div>
    </div>

    <!-- Modal for Smart Import -->
    <div id="smart-import-modal" class="modal-overlay" style="display:none;">
        <div class="modal-box" style="max-width:600px; width:95%;">
            <h3>๐ง ุงูุงุณุชูุฑุงุฏ ุงูุฐูู (Smart Parser)</h3>
            <p>ุงูุณุฎ ุงูุฃุณุฆูุฉ ูู ููู ุงูู Word ุฃู PDF ูุถุนูุง ููุงุ ูุณูููู ุงููุธุงู ุจุชุญููููุง ููุฑูุช.</p>
            <textarea id="smart-import-text" rows="10" placeholder="ูุซุงู:&#10;ุณ1: ูุง ูู ุงูุชูุฑูุถุ&#10;ุฃ) ุนูู&#10;ุจ) ูู&#10;*ุฌ) ููุงููุง" style="width:100%; border:2px solid var(--primary-color); padding:10px;"></textarea>
            <div class="modal-buttons">
                <button class="start-btn magic-btn" onclick="processSmartImport()">โก ุชุญููู ุฅูู ูุฑูุช</button>
                <button class="back-btn" onclick="document.getElementById('smart-import-modal').style.display='none'">ุฅูุบุงุก</button>
            </div>
        </div>
    </div>

    <!-- Modal for Editing User Name -->
    <div id="edit-user-modal" class="modal-overlay" style="display:none;">
        <div class="modal-box">
            <h3>ุชุนุฏูู ุงุณู ุงูุทุงูุจ</h3>
            <input type="hidden" id="edit-user-id">
            <input type="text" id="edit-user-fullname" placeholder="ุงูุงุณู ุงูุฌุฏูุฏ">
            <div class="modal-buttons">
                <button class="start-btn" onclick="saveUserEdit()">ุญูุธ</button>
                <button class="back-btn" onclick="document.getElementById('edit-user-modal').style.display='none'">ุฅูุบุงุก</button>
            </div>
        </div>
    </div>

    <!-- Quiz Elements -->
    <div id="quiz-container" class="quiz-container">
      <button class="back-btn go-back" onclick="backToQuizList()">โ ุฎุฑูุฌ</button>
      <div class="quiz-header">
        <h2 id="current-quiz-title" class="quiz-title"></h2>
        <div class="progress-bar"><div id="progress-fill" class="progress-fill"></div></div>
        <p id="question-counter"></p>
        <div id="quiz-timer" class="timer-badge">00:00</div>
      </div>
      <div id="question-container"></div>
      <div class="quiz-navigation">
        <button id="prev-btn" class="nav-btn" disabled>ุงูุณุงุจู</button>
        <button id="next-btn" class="nav-btn">ุงูุชุงูู</button>
      </div>
    </div>

    <div id="results" class="quiz-container results">
      <h3>ุงูุชูู ุงูุงุฎุชุจุงุฑ!</h3>
      <div id="final-score" class="score"></div>
      <p id="score-message"></p>
      <p id="upload-status" style="font-size: 0.9rem; color: gray; margin-top:5px;"></p>
      <button id="review-btn" class="start-btn">ูุฑุงุฌุนุฉ ุงูุฅุฌุงุจุงุช</button>
      <button class="start-btn go-back" onclick="backToQuizList()">ุงูุนูุฏุฉ ูููุงุฆูุฉ</button>
    </div>

    <div id="review-container" class="review-container">
      <h2 class="quiz-title">ูุฑุงุฌุนุฉ ุงูุฅุฌุงุจุงุช</h2>
      <button class="back-btn" id="back-to-results">โ ุงูุนูุฏุฉ ูููุชุงุฆุฌ</button>
      <div id="review-content"></div>
      <button class="start-btn go-back" onclick="backToQuizList()">ุงูุนูุฏุฉ ูููุงุฆูุฉ</button>
    </div>

    <div class="footer">
      <p>Created by Zyad & Yusuf</p>
      <a href="https://zyadyasser2007.sarhne.com" target="_blank" class="sarhne-btn">ุตุงุฑุญูู ๐โค๏ธ</a>
    </div>
  </div>

  <script src="script.js"></script>
</body>
</html>

