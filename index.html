<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title> Nursing Platform </title>
  <link rel="stylesheet" href="style.css">
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
</head>
<body>

  <!-- Auth Modal (Login / Sign Up) -->
  <div id="welcome-modal" class="modal-overlay">
    <div class="modal-box">
      
      <!-- Login View -->
      <div id="login-view">
        <h2>ุชุณุฌูู ุงูุฏุฎูู ๐</h2>
        <p>ุฃุฏุฎู ุงุณู ุงููุณุชุฎุฏู ุงูุฎุงุต ุจู</p>
        <input type="text" id="login-username" placeholder="Username (e.g. zyad2007)" style="text-align: left; direction: ltr;" />
        <button class="start-btn" onclick="loginUser()">ุฏุฎูู</button>
        <p style="margin-top: 15px; font-size: 0.9rem; color: var(--text-light);">
          ุทุงูุจ ุฌุฏูุฏุ <a href="#" onclick="toggleAuthView('signup')" style="color: var(--primary-color); font-weight: bold; text-decoration: none;">ุฃูุดุฆ ุญุณุงุจ ุงูุขู</a>
        </p>
      </div>

      <!-- Signup View -->
      <div id="signup-view" style="display: none;">
        <h2>ุญุณุงุจ ุฌุฏูุฏ โจ</h2>
        <p>ุณุฌู ุจูุงูุงุชู ููุฑุฉ ูุงุญุฏุฉ ููุท</p>
        <input type="text" id="signup-fullname" placeholder="ุงูุงุณู ุงูุซูุงุซู (ุจุงูุนุฑุจู)" />
        <input type="text" id="signup-username" placeholder="ุงุณู ุงููุณุชุฎุฏู (ุฅูุฌููุฒู ููุท)" style="text-align: left; direction: ltr;" />
        <button class="start-btn" onclick="registerUser()">ุฅูุดุงุก ุงูุญุณุงุจ</button>
        <p style="margin-top: 15px; font-size: 0.9rem; color: var(--text-light);">
          ูุฏูู ุญุณุงุจ ุจุงููุนูุ <a href="#" onclick="toggleAuthView('login')" style="color: var(--primary-color); font-weight: bold; text-decoration: none;">ุชุณุฌูู ุงูุฏุฎูู</a>
        </p>
      </div>

      <!-- Error Message Area -->
      <p id="auth-error" style="color: #ef4444; font-size: 0.95rem; display: none; margin-top: 10px; font-weight: bold;"></p>
    
    </div>
  </div>

  <!-- Admin Login -->
  <div id="admin-login-modal" class="modal-overlay" style="display: none;">
    <div class="modal-box">
      <h2>ุฏุฎูู ุงููุดุฑููู ๐</h2>
      <input type="password" id="admin-password-input" placeholder="ูููุฉ ุงููุฑูุฑ..." />
      <div class="modal-buttons">
          <button class="start-btn" onclick="checkAdminPassword()">ุฏุฎูู</button>
          <button class="back-btn" onclick="closeAdminLogin()">ุฅูุบุงุก</button>
      </div>
    </div>
  </div>

  <div class="container">
    <div class="header">
      <div class="header-controls">
          <button id="theme-toggle" class="icon-btn" title="ุชุบููุฑ ุงููุถุน">๐</button>
          <button onclick="logout()" class="icon-btn logout-icon" title="ุชุณุฌูู ุฎุฑูุฌ">๐ช</button>
          <button onclick="openDashboard()" class="icon-btn dashboard-icon" title="ุฅุญุตุงุฆูุงุชู">๐</button>
          <button onclick="openAdminLogin()" class="icon-btn admin-icon" title="ููุญุฉ ุงููุดุฑููู">๐จโ๐ผ</button>
      </div>
      
      <h1 id="site-title">ููุตุฉ ุงูุงุฎุชุจุงุฑุงุช</h1>
      <p id="welcome-message">ุฃููุงู ุจู</p>
    </div>

    <!-- Main Content -->
    <div id="main-nav" class="tab-container"></div>
    <div id="source-selection" class="source-container"></div>
    <div id="quiz-list-area" class="tab-content active" style="display:none;">
        <button class="back-btn" onclick="backToSources()">โ ุชุบููุฑ ุงููุตุฏุฑ</button>
        <h3 id="source-title-display" style="text-align:center; color:var(--primary-color);"></h3>
        <div id="dynamic-cards-container" class="cards-grid"></div>
    </div>

    <!-- Student Dashboard -->
    <div id="dashboard-view" class="dashboard-view" style="display:none;">
        <h2 class="quiz-title">ุฅุญุตุงุฆูุงุชู ุงูุดุฎุตูุฉ ๐</h2>
        <div class="stats-grid">
            <div class="stat-card"><div class="stat-icon">๐</div><div class="stat-info"><span id="total-quizzes-taken">0</span><p>ูููุฒุงุช</p></div></div>
            <div class="stat-card"><div class="stat-icon">๐ฏ</div><div class="stat-info"><span id="total-accuracy">0%</span><p>ุงูุฏูุฉ</p></div></div>
            <div class="stat-card"><div class="stat-icon">๐</div><div class="stat-info"><span id="total-attempts">0</span><p>ูุญุงููุงุช</p></div></div>
        </div>
        <div class="history-table-container">
            <table id="history-table">
                <thead><tr><th>ุงูุงูุชุญุงู</th><th>ุฃุนูู ุฏุฑุฌุฉ</th><th>ุขุฎุฑ ุฏุฑุฌุฉ</th><th>ุงููุญุงููุงุช</th></tr></thead>
                <tbody id="history-table-body"></tbody>
            </table>
        </div>
        <button class="start-btn go-back" onclick="closeDashboard()" style="margin-top:20px;">ุงูุนูุฏุฉ ููุฑุฆูุณูุฉ</button>
    </div>

    <!-- Admin Dashboard -->
    <div id="admin-dashboard-view" class="dashboard-view" style="display:none;">
        <div style="display:flex; justify-content:space-between; align-items:center; flex-wrap: wrap; margin-bottom:20px;">
            <h2 class="quiz-title" style="color:var(--secondary-color);">๐จโ๐ผ ููุญุฉ ุงูุชุญูู ุงูุดุงููุฉ</h2>
            <button class="start-btn" onclick="closeAdminDashboard()" style="background:#475569; width:auto;">ุฎุฑูุฌ</button>
        </div>

        <div class="tab-container" style="justify-content: center; margin-bottom: 20px;">
            <button class="tab-btn active" onclick="switchAdminTab('results')">๐ ุงููุชุงุฆุฌ</button>
            <button class="tab-btn" onclick="switchAdminTab('users')">๐ฅ ุงูุทูุงุจ</button>
            <button class="tab-btn" onclick="switchAdminTab('content')">๐ ุงููุญุชูู</button>
            <button class="tab-btn" onclick="switchAdminTab('settings')">โ๏ธ ุงูุฅุนุฏุงุฏุงุช</button>
        </div>

        <!-- 1. Results -->
        <div id="admin-tab-results" class="admin-tab-content">
            <div class="filter-container" style="display:flex; gap:10px; margin-bottom:15px;">
                <input type="text" id="admin-search" placeholder="ุงุจุญุซ ุจุงุณู ุงูุทุงูุจ ุฃู ุงูููุฒุฑ..." onkeyup="filterAdminTable()" style="padding: 10px; flex-grow:1; border:1px solid #ccc; border-radius:8px;">
                <button class="start-btn" onclick="fetchAdminData()" style="background:#3b82f6; width:auto;">๐ ุชุญุฏูุซ</button>
                <button class="start-btn" onclick="exportToExcel()" style="background:#22c55e; width:auto;">๐ฅ Excel</button>
            </div>
            <div class="history-table-container">
                <table id="admin-table">
                    <thead><tr><th>ุงูุทุงูุจ (ุงูููุฒุฑ)</th><th>ุงููุงุฏุฉ</th><th>ุงููููุฒ</th><th>ุงูุฏุฑุฌุฉ</th><th>ุงูุชุงุฑูุฎ</th></tr></thead>
                    <tbody id="admin-table-body">
                        <tr><td colspan="5" style="text-align:center">ุงุถุบุท ุชุญุฏูุซ...</td></tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- 2. Users -->
        <div id="admin-tab-users" class="admin-tab-content" style="display:none;">
            <div class="filter-container" style="display:flex; gap:10px; margin-bottom:15px;">
                <input type="text" id="users-search" placeholder="ุงุจุญุซ ุนู ุทุงูุจ..." onkeyup="filterUsersTable()" style="padding: 10px; flex-grow:1; border:1px solid #ccc; border-radius:8px;">
                <button class="start-btn" onclick="fetchAdminUsers()" style="background:#3b82f6; width:auto;">๐ ุชุญุฏูุซ</button>
            </div>
            <div class="history-table-container">
                <table id="users-table">
                    <thead><tr><th>ุงูุทุงูุจ (ุงูููุฒุฑ)</th><th>ุชุงุฑูุฎ ุงูุงูุถูุงู</th><th>ุฅุฌุฑุงุกุงุช</th></tr></thead>
                    <tbody id="users-table-body">
                        <tr><td colspan="3" style="text-align:center">ุฌุงุฑู ุงูุชุญููู...</td></tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- 3. Content (Updated for Advanced Exam Settings) -->
        <div id="admin-tab-content" class="admin-tab-content" style="display:none;">
            <!-- Add Subject -->
            <div class="review-question" style="background:white; border-color:var(--primary-color);">
                <h3>1. ุฅุถุงูุฉ ูุงุฏุฉ ุฌุฏูุฏุฉ</h3>
                <div style="display:flex; gap:10px;">
                    <input type="text" id="new-subject-name" placeholder="ุงุณู ุงููุงุฏุฉ (ุนุฑุจู)..." style="padding:10px; flex-grow:1;">
                    <input type="text" id="new-subject-id" placeholder="ID (English)..." style="padding:10px; width:150px;">
                    <button class="start-btn" onclick="addNewSubject()" style="width:auto;">โ ุฅุถุงูุฉ</button>
                </div>
            </div>
            <!-- Add Source -->
            <div class="review-question" style="background:white; border-color:var(--secondary-color);">
                <h3>2. ุฅุถุงูุฉ ูุตุฏุฑ ุฌุฏูุฏ</h3>
                <div style="display:flex; gap:10px; flex-direction:column;">
                    <select id="source-subject-select" style="padding:10px;"></select>
                    <div style="display:flex; gap:10px;">
                        <input type="text" id="new-source-name" placeholder="ุงุณู ุงููุตุฏุฑ..." style="padding:10px; flex-grow:1;">
                        <input type="text" id="new-source-id" placeholder="ID (English)..." style="padding:10px; width:150px;">
                        <button class="start-btn" onclick="addNewSource()" style="width:auto;">โ ุฅุถุงูุฉ</button>
                    </div>
                </div>
            </div>

            <!-- Add Exam (NEW ADVANCED UI) -->
            <div class="review-question" style="background:white; border-color:#22c55e;">
                <h3>3. ุฅุถุงูุฉ ุงูุชุญุงู ุฌุฏูุฏ (ูุธุงู ูุชุทูุฑ) ๐ง</h3>
                
                <!-- Main Info -->
                <div style="display:flex; gap:10px; flex-wrap:wrap; margin-bottom:10px;">
                    <select id="exam-subject-select" onchange="updateSourceSelect()" style="padding:10px; flex-grow:1;"></select>
                    <select id="exam-source-select" style="padding:10px; flex-grow:1;"></select>
                </div>
                <input type="text" id="new-exam-title" placeholder="ุนููุงู ุงูุงูุชุญุงู..." style="padding:10px; width:100%; margin-bottom:15px;">

                <!-- Settings Grid -->
                <div class="settings-grid">
                    <!-- Time Settings -->
                    <div class="setting-box">
                        <h4 class="setting-title">โฑ๏ธ ุฅุนุฏุงุฏุงุช ุงูููุช</h4>
                        <div style="display:grid; gap:8px;">
                            <div class="date-input-group">
                                <label>ุงูุจุฏุงูุฉ:</label>
                                <input type="datetime-local" id="exam-start-date">
                            </div>
                            <div class="date-input-group">
                                <label>ุงูููุงูุฉ:</label>
                                <input type="datetime-local" id="exam-end-date">
                            </div>
                            <div class="date-input-group" style="border-top:1px solid #eee; padding-top:5px;">
                                <label>ุงููุฏุฉ (ุฏ):</label>
                                <input type="number" id="new-exam-time" placeholder="0 = ููุชูุญ">
                            </div>
                        </div>
                    </div>

                    <!-- Display Settings -->
                    <div class="setting-box">
                        <h4 class="setting-title">โ๏ธ ุฅุนุฏุงุฏุงุช ุงูุนุฑุถ</h4>
                        <div style="display:grid; gap:8px;">
                            <label class="checkbox-label">
                                <input type="checkbox" id="setting-one-time"> ูุญุงููุฉ ูุงุญุฏุฉ ููุท
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" id="setting-shuffle-q"> ุฎูุท ุงูุฃุณุฆูุฉ
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" id="setting-prevent-back"> ููุน ุงูุฑุฌูุน ููุณุงุจู
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" id="setting-show-result" checked> ุฅุธูุงุฑ ุงููุชูุฌุฉ ููุฑุงู
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Editor Tabs -->
                <div class="editor-tabs-container">
                    <button class="editor-tab active" onclick="switchEditorMode('text')" id="tab-text-mode">๐ ูุต ุฎุงู (ุณุฑูุน)</button>
                    <button class="editor-tab" onclick="switchEditorMode('visual')" id="tab-visual-mode">๐จ ุงููุญุฑุฑ ุงูุจุตุฑู (ูุชูุฏู)</button>
                </div>

                <!-- 1. Text Mode -->
                <div id="editor-text-mode" class="editor-content">
                    <textarea id="raw-exam-text" rows="8" placeholder="ุณ: ุงูุณุคุงู...&#10;ุฃ) ุฎูุงุฑ 1&#10;*ุจ) ุฎูุงุฑ ุตุญูุญ&#10;..." style="width:100%; padding:10px;"></textarea>
                    <button class="start-btn" onclick="convertAndSwitchToVisual()" style="background:#3b82f6; margin-top:10px;">โฌ๏ธ ุชุญููู ูููุญุฑุฑ ุงูุจุตุฑู</button>
                    <p style="font-size:0.8rem; color:gray; margin-top:5px;">ููุถู ุงุณุชุฎุฏุงู ุงูุชุญููู ููุฑุงุฌุนุฉ ุงูุฃุณุฆูุฉ ูุจู ุงูุญูุธ.</p>
                </div>

                <!-- 2. Visual Mode -->
                <div id="editor-visual-mode" class="editor-content" style="display:none;">
                    <div id="visual-questions-container">
                        <!-- Questions will be rendered here by JS -->
                    </div>
                    <button class="start-btn" onclick="addVisualQuestion()" style="background:#64748b; width:auto; margin-top:15px;">โ ุณุคุงู ุฌุฏูุฏ</button>
                </div>

                <hr style="margin: 20px 0; border: 0; border-top: 1px solid #ddd;">
                
                <button class="start-btn" onclick="saveExamFinal()" style="background:#22c55e; font-size:1.1rem;">๐พ ุญูุธ ุงูุงูุชุญุงู ุงูููุงุฆู</button>
            </div>

            <!-- Delete Section -->
            <div class="delete-section">
                <h3>4. ๐๏ธ ุญุฐู ุงููุญุชูู</h3>
                <div class="delete-controls">
                    <select id="delete-type-select" onchange="updateDeleteDropdown()" style="padding:10px; border-radius:8px;">
                        <option value="none">-- ุงุฎุชุฑ ุงูุญุฐู --</option>
                        <option value="subject">ูุงุฏุฉ</option>
                        <option value="source">ูุตุฏุฑ</option>
                        <option value="quiz">ุงูุชุญุงู</option>
                    </select>
                    <select id="delete-item-select" style="padding:10px; border-radius:8px; flex-grow:1; display:none;"></select>
                    <button class="btn-danger" onclick="deleteSelectedItem()">ุญุฐู</button>
                </div>
            </div>
        </div>

        <!-- 4. Settings -->
        <div id="admin-tab-settings" class="admin-tab-content" style="display:none;">
            <div class="admin-setting-card">
                <h3>โน๏ธ ูุนูููุงุช ุงููุธุงู</h3>
                <p>ูุนูู ุงููุธุงู ุงูุขู ุจุชุณุฌูู ุงูุฏุฎูู ุนุจุฑ (ุงุณู ุงููุณุชุฎุฏู) ุงููุฑูุฏ.</p>
            </div>
            <div class="admin-danger-zone" style="background: #fee2e2; padding: 20px; border-radius: 10px; border: 1px solid #ef4444; text-align:center;">
                <h3 style="color:#b91c1c;">โ๏ธ ููุทูุฉ ุงูุฎุทุฑ</h3>
                <div style="display:flex; gap:20px; justify-content:center; margin-top:20px;">
                    <button onclick="adminResetAllResults()" style="background:#ef4444; color:white; border:none; padding:10px 20px; border-radius:5px; cursor:pointer;">๐๏ธ ุญุฐู ุงููุชุงุฆุฌ</button>
                    <button onclick="adminDeleteAllUsers()" style="background:#b91c1c; color:white; border:none; padding:10px 20px; border-radius:5px; cursor:pointer;">๐ฅ ุญุฐู ุงููุณุชุฎุฏููู</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Quiz Elements -->
    <div id="quiz-container" class="quiz-container">
      <button class="back-btn go-back" onclick="backToQuizList()">โ ุฎุฑูุฌ</button>
      <div class="quiz-header">
        <h2 id="current-quiz-title" class="quiz-title"></h2>
        <div class="progress-bar"><div id="progress-fill" class="progress-fill"></div></div>
        <p id="question-counter"></p>
        <div id="quiz-timer" class="timer-badge">00:00</div>
      </div>
      <div id="question-container"></div>
      <div class="quiz-navigation">
        <button id="prev-btn" class="nav-btn" disabled>ุงูุณุงุจู</button>
        <button id="next-btn" class="nav-btn">ุงูุชุงูู</button>
      </div>
    </div>

    <div id="results" class="quiz-container results">
      <h3>ุงูุชูู ุงูุงุฎุชุจุงุฑ!</h3>
      <div id="final-score" class="score"></div>
      <p id="score-message"></p>
      <p id="upload-status" style="font-size: 0.9rem; color: gray; margin-top:5px;"></p>
      <button id="review-btn" class="start-btn">ูุฑุงุฌุนุฉ ุงูุฅุฌุงุจุงุช</button>
      <button class="start-btn go-back" onclick="backToQuizList()">ุงูุนูุฏุฉ ูููุงุฆูุฉ</button>
    </div>

    <div id="review-container" class="review-container">
      <h2 class="quiz-title">ูุฑุงุฌุนุฉ ุงูุฅุฌุงุจุงุช</h2>
      <button class="back-btn" id="back-to-results">โ ุงูุนูุฏุฉ ูููุชุงุฆุฌ</button>
      <div id="review-content"></div>
      <button class="start-btn go-back" onclick="backToQuizList()">ุงูุนูุฏุฉ ูููุงุฆูุฉ</button>
    </div>

    <div class="footer">
      <p>Created by Zyad & Yusuf</p>
      <a href="https://zyadyasser2007.sarhne.com" target="_blank" class="sarhne-btn">ุตุงุฑุญูู ๐โค๏ธ</a>
    </div>
  </div>

  <script src="script.js"></script>
</body>
</html>

