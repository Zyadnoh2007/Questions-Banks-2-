<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Nursing Platform</title>
  <link rel="stylesheet" href="style.css">
  <!-- ููุชุจุงุช Firebase ู Excel -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>
<body>

  <!-- ุดุฑูุท ุงูุฅุนูุงูุงุช -->
  <div id="announcement-bar" class="announcement-bar" style="display:none;">
    <span id="announcement-text"></span>
    <button onclick="closeAnnouncement()">โ</button>
  </div>

  <!-- ูุงูุฐุฉ ุงูุฏุฎูู (ุงูุชุตููู ุงูููุงุณููู) -->
  <div id="welcome-modal" class="modal-overlay">
    <div class="modal-box">
      <h2>ูุฑุญุจุงู ุจู ูุง ุฏูุชูุฑ ๐ฉบ</h2>
      
      <!-- ุชุจุฏูู ุงูุฏุฎูู -->
      <div class="auth-toggle">
        <button id="btn-login-view" class="active" onclick="toggleAuthView('login')">ุชุณุฌูู ุฏุฎูู</button>
        <button id="btn-register-view" onclick="toggleAuthView('register')">ุญุณุงุจ ุฌุฏูุฏ</button>
      </div>

      <!-- ููุฑู ุงูุฏุฎูู -->
      <div id="login-view">
        <p>ุงุฏุฎู ุงูููุฏ (User ID) ุฃู ุงุณูู ุงููุณุฌู</p>
        <input type="text" id="login-input" placeholder="User ID..." style="direction:ltr; text-align:center;">
        <p id="login-error" style="color:red; display:none;"></p>
        <button class="start-btn" onclick="handleLogin()">ุฏุฎูู</button>
      </div>

      <!-- ููุฑู ุงูุชุณุฌูู -->
      <div id="register-view" style="display:none;">
        <p>ุจูุงูุงุช ุงูุทุงูุจ ุงูุฌุฏูุฏ</p>
        <input type="text" id="reg-name" placeholder="ุงูุงุณู ุงูุซูุงุซู (ุจุงูุนุฑุจู)">
        <input type="text" id="reg-user" placeholder="User ID (ุฅูุฌููุฒู ููุท)" style="direction:ltr; text-align:center;">
        <small style="color:#666; display:block; margin-bottom:10px;">ูุซุงู: ahmed99 (ุจุฏูู ูุณุงูุงุช)</small>
        <p id="reg-error" style="color:red; display:none;"></p>
        <button class="start-btn" onclick="handleRegister()">ุฅูุดุงุก ุญุณุงุจ</button>
      </div>
    </div>
  </div>

  <!-- ูุงูุฐุฉ ุฃุฏูู -->
  <div id="admin-login-modal" class="modal-overlay" style="display: none;">
    <div class="modal-box">
      <h2>ุฏุฎูู ุงููุดุฑููู ๐</h2>
      <input type="password" id="admin-password-input" placeholder="ูููุฉ ุงููุฑูุฑ..." />
      <div style="margin-top:15px; display:flex; gap:10px; justify-content:center;">
          <button class="start-btn" onclick="checkAdminPassword()">ุฏุฎูู</button>
          <button class="back-btn" onclick="document.getElementById('admin-login-modal').style.display='none'" style="margin:0;">ุฅูุบุงุก</button>
      </div>
    </div>
  </div>

  <div class="container">
    <div class="header">
      <div class="header-controls">
          <button id="theme-toggle" class="icon-btn">๐</button>
          <button onclick="logout()" class="icon-btn">๐ช</button>
          <button onclick="openDashboard()" class="icon-btn">๐</button>
          <button onclick="checkAdminSession()" class="icon-btn">๐จโ๐ผ</button>
      </div>
      
      <h1 id="site-title">ููุตุฉ ุงูุงุฎุชุจุงุฑุงุช</h1>
      <p id="welcome-message">ุฃููุงู ุจู</p>
    </div>

    <!-- ููุญุฉ ุงูุดุฑู -->
    <div id="leaderboard-section" class="leaderboard-container" style="display:none;">
        <h3>๐ ููุญุฉ ุงูุดุฑู ๐</h3>
        <div id="leaderboard-list" class="leaderboard-grid"></div>
    </div>

    <!-- ุงููุญุชูู ุงูุฑุฆูุณู -->
    <div id="main-nav" class="tab-container"></div>
    <div id="source-selection" class="source-container"></div>
    
    <div id="quiz-list-area" style="display:none;">
        <button class="back-btn" onclick="backToSources()">โ ุชุบููุฑ ุงููุตุฏุฑ</button>
        <h3 id="source-title-display" style="text-align:center; color:var(--primary-color);"></h3>
        <div id="dynamic-cards-container" class="cards-grid"></div>
    </div>

    <!-- ููุญุฉ ุงูุทุงูุจ -->
    <div id="dashboard-view" class="dashboard-view" style="display:none;">
        <h2 class="quiz-title">ุฅุญุตุงุฆูุงุชู</h2>
        <div class="stats-grid">
            <div class="stat-card"><div class="stat-icon">๐</div><div class="stat-info"><span id="total-quizzes-taken">0</span><p>ูููุฒุงุช</p></div></div>
            <div class="stat-card"><div class="stat-icon">๐ฏ</div><div class="stat-info"><span id="total-accuracy">0%</span><p>ุงูุฏูุฉ</p></div></div>
            <div class="stat-card"><div class="stat-icon">๐</div><div class="stat-info"><span id="total-attempts">0</span><p>ูุญุงููุงุช</p></div></div>
        </div>
        <div class="history-table-container">
            <table id="history-table">
                <thead><tr><th>ุงูุงูุชุญุงู</th><th>ุฃุนูู ุฏุฑุฌุฉ</th><th>ุขุฎุฑ ุฏุฑุฌุฉ</th><th>ุงููุญุงููุงุช</th></tr></thead>
                <tbody id="history-table-body"></tbody>
            </table>
        </div>
        <button class="start-btn" onclick="closeDashboard()" style="margin-top:20px; background:#666;">ุงูุนูุฏุฉ</button>
    </div>

    <!-- ููุญุฉ ุงูุฃุฏูู -->
    <div id="admin-dashboard-view" class="dashboard-view" style="display:none;">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
            <h2 style="color:var(--primary-color);">ููุญุฉ ุงูุชุญูู ๐จโโ๏ธ</h2>
            <button class="start-btn" onclick="adminLogout()" style="width:auto; background:#444;">ุฎุฑูุฌ</button>
        </div>

        <div class="tab-container" style="justify-content:center;">
            <button class="tab-btn active" onclick="switchAdminTab('results')">๐ ุงููุชุงุฆุฌ</button>
            <button class="tab-btn" onclick="switchAdminTab('users')">๐ฅ ุงูุทูุงุจ</button>
            <button class="tab-btn" onclick="switchAdminTab('content')">๐ ุงููุญุชูู</button>
            <button class="tab-btn" onclick="switchAdminTab('settings')">โ๏ธ ุฅุนุฏุงุฏุงุช</button>
        </div>

        <!-- 1. ุงููุชุงุฆุฌ -->
        <div id="admin-tab-results" class="admin-content">
            <div style="display:flex; gap:10px; margin-bottom:15px;">
                <input type="text" id="results-search" placeholder="ุจุญุซ ุจุงุณู ุงูุทุงูุจ..." onkeyup="filterResults()" style="padding:10px; flex:1;">
                <button class="start-btn" onclick="fetchGroupedResults()" style="width:auto;">ุชุญุฏูุซ</button>
                <button class="start-btn" onclick="printAllReports()" style="width:auto; background:#22c55e;">ุทุจุงุนุฉ ุงููู</button>
                <button class="start-btn" onclick="exportExcel()" style="width:auto; background:#16a34a;">Excel</button>
            </div>
            <div id="results-container"></div>
        </div>

        <!-- 2. ุงูุทูุงุจ -->
        <div id="admin-tab-users" class="admin-content" style="display:none;">
            <div style="display:flex; gap:10px; margin-bottom:15px;">
                <input type="text" id="users-search" placeholder="ุจุญุซ..." onkeyup="filterUsersTable()" style="padding:10px; flex:1;">
                <button class="start-btn" onclick="fetchAdminUsers()" style="width:auto;">ุชุญุฏูุซ</button>
            </div>
            <div class="history-table-container">
                <table id="users-table">
                    <thead><tr><th>ุงูุงุณู</th><th>User ID</th><th>ุงูุญุงูุฉ</th><th>ุฅุฌุฑุงุก</th></tr></thead>
                    <tbody id="users-table-body"></tbody>
                </table>
            </div>
        </div>

        <!-- 3. ุงููุญุชูู -->
        <div id="admin-tab-content" class="admin-content" style="display:none;">
            <div class="admin-card">
                <h3>ุฅุถุงูุฉ ุงูุชุญุงู ุฌุฏูุฏ</h3>
                <select id="exam-subject-select" onchange="updateSourceSelect()" style="padding:10px; margin-bottom:10px; width:100%"></select>
                <select id="exam-source-select" style="padding:10px; margin-bottom:10px; width:100%"></select>
                <input type="text" id="new-exam-title" placeholder="ุนููุงู ุงูุงูุชุญุงู..." style="width:100%; padding:10px; margin-bottom:10px;">
                
                <div style="background:#eee; padding:10px; border-radius:8px; margin-bottom:10px;">
                    <label>ุงููุฏุฉ (ุฏ): <input type="number" id="new-exam-time" value="0" style="width:60px; padding:5px;"></label>
                    <label><input type="checkbox" id="opt-one-attempt"> ูุฑุฉ ูุงุญุฏุฉ</label>
                    <label><input type="checkbox" id="opt-random-q"> ุนุดูุงุฆู</label>
                    <label><input type="checkbox" id="opt-hide-result"> ุฅุฎูุงุก ุงููุชูุฌุฉ</label>
                </div>

                <div style="border:2px dashed #3b82f6; padding:15px; background:#f0f7ff; border-radius:8px; margin-bottom:15px;">
                    <h4>โก ูุณุฎ ุงูุฃุณุฆูุฉ (Smart Paste)</h4>
                    <p style="font-size:0.8rem; margin:0;">ูุฏุนู ุงูุฅูุฌููุฒู: 1. Question? a) Option *b) Correct</p>
                    <textarea id="smart-paste-input" rows="5" placeholder="ุงูุตู ุงูุฃุณุฆูุฉ ููุง..." style="width:100%; direction:ltr; margin-top:5px;"></textarea>
                    <button class="start-btn" onclick="parseSmartPaste()" style="margin-top:5px;">ุชุญููู</button>
                </div>

                <div id="visual-editor"></div>
                <button class="start-btn" onclick="saveExamFinal()" style="background:#22c55e; margin-top:15px;">ุญูุธ ุงูุงูุชุญุงู</button>
            </div>
            
            <div class="admin-card" style="margin-top:20px;">
                <h4 style="cursor:pointer" onclick="this.nextElementSibling.style.display='block'">โ ุฅุถุงูุฉ ูุงุฏุฉ / ูุตุฏุฑ (ุงุถุบุท ููุง)</h4>
                <div style="display:none;">
                    <input id="new-sub-name" placeholder="ุงุณู ุงููุงุฏุฉ"><input id="new-sub-id" placeholder="ID">
                    <button onclick="addNewSubject()" class="start-btn" style="width:auto; padding:5px 10px;">ุถู ูุงุฏุฉ</button>
                    <hr>
                    <select id="src-sub-select"></select>
                    <input id="new-src-name" placeholder="ุงุณู ุงููุตุฏุฑ"><input id="new-src-id" placeholder="ID">
                    <button onclick="addNewSource()" class="start-btn" style="width:auto; padding:5px 10px;">ุถู ูุตุฏุฑ</button>
                </div>
            </div>
        </div>

        <!-- 4. ุฅุนุฏุงุฏุงุช -->
        <div id="admin-tab-settings" class="admin-content" style="display:none;">
            <div class="admin-card">
                <h3>๐ข ุงูุฅุนูุงูุงุช</h3>
                <textarea id="announcement-input" rows="2" style="width:100%; padding:10px;"></textarea>
                <div style="margin-top:10px;">
                    <button onclick="saveAnnouncement()" class="start-btn" style="width:auto;">ูุดุฑ</button>
                    <button onclick="clearAnnouncement()" class="start-btn" style="width:auto; background:#d9534f;">ุญุฐู</button>
                </div>
            </div>
            <div class="admin-card" style="margin-top:15px;">
                <label><input type="checkbox" id="leaderboard-toggle" onchange="toggleLeaderboard()"> ุชูุนูู ููุญุฉ ุงูุดุฑู</label>
            </div>
        </div>
    </div>

    <!-- ุดุงุดุงุช ุงูุงูุชุญุงู -->
    <div id="quiz-container" style="display:none;" class="quiz-view">
        <div class="quiz-header">
            <h2 id="current-quiz-title"></h2>
            <div id="quiz-timer" class="timer-badge">00:00</div>
        </div>
        <div id="question-container"></div>
        <div class="quiz-nav">
            <button id="prev-btn" class="nav-btn" disabled>ุงูุณุงุจู</button>
            <span id="q-counter"></span>
            <button id="next-btn" class="nav-btn">ุงูุชุงูู</button>
        </div>
    </div>

    <div id="results" class="quiz-view" style="display:none; text-align:center;">
        <h3>ุงูุชูู ุงูุงูุชุญุงู</h3>
        <h1 id="final-score" style="font-size:3rem; color:var(--primary-color);"></h1>
        <p id="score-message"></p>
        <button id="review-btn" class="start-btn">ูุฑุงุฌุนุฉ ุงูุฅุฌุงุจุงุช</button>
        <button class="start-btn" onclick="location.reload()" style="background:#666;">ุฎุฑูุฌ</button>
    </div>

    <div id="review-container" class="quiz-view" style="display:none;">
        <h3>ูุฑุงุฌุนุฉ ุงูุฅุฌุงุจุงุช</h3>
        <div id="review-content"></div>
        <button class="start-btn" onclick="location.reload()" style="margin-top:20px;">ุฎุฑูุฌ</button>
    </div>

    <div class="footer">
      <p>Created by Zyad & Yusuf</p>
      <a href="https://zyadyasser2007.sarhne.com" target="_blank" class="sarhne-btn">ุตุงุฑุญูู ๐โค๏ธ</a>
    </div>
  </div>

  <!-- ููุทูุฉ ุงูุทุจุงุนุฉ ุงููุฎููุฉ -->
  <div id="print-area"></div>

  <script src="script.js"></script>
</body>
</html>


