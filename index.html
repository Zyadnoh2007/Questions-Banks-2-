<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Nursing Platform</title>
  <!-- ููุชุจุฉ ุงูุฎุทูุท ูุงูุฃููููุงุช -->
  <link rel="stylesheet" href="style.css">
  <link href="https://fonts.googleapis.com/css2?family=Almarai:wght@300;400;700;800&display=swap" rel="stylesheet">
  
  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
  <!-- SheetJS for Excel Export -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>
<body>

  <!-- ุดุฑูุท ุงูุฅุนูุงูุงุช ุงูุนูููุฉ -->
  <div id="announcement-bar" class="announcement-bar" style="display:none;">
    <span id="announcement-text"></span>
    <button onclick="closeAnnouncement()" class="close-announcement">ร</button>
  </div>

  <!-- โ ูุงูุฐุฉ ุงูุฏุฎูู ุงูุงุญุชุฑุงููุฉ ุงูุฌุฏูุฏุฉ โ -->
  <div id="auth-modal" class="modal-overlay">
    <div class="modal-box auth-card">
      
      <!-- ุงูุชุจููุจุงุช ุงูุนูููุฉ -->
      <div class="auth-tabs-wrapper">
        <div class="auth-tabs">
          <button id="tab-login" class="auth-tab active" onclick="switchAuthMode('login')">ุชุณุฌูู ุฏุฎูู</button>
          <button id="tab-register" class="auth-tab" onclick="switchAuthMode('register')">ุญุณุงุจ ุฌุฏูุฏ</button>
        </div>
      </div>

      <!-- ูุญุชูู ุชุณุฌูู ุงูุฏุฎูู -->
      <div id="login-form" class="auth-content fade-in">
        <div class="auth-header">
          <h3>ุฃููุงู ุจุนูุฏุชู ูุง ุฏูุชูุฑ ๐ฉบ</h3>
          <p>ุงุฏุฎู ุงูููุฏ ุงูุฎุงุต ุจู ูููุชุงุจุนุฉ</p>
        </div>
        
        <div class="input-group">
          <label>ุงุณู ุงููุณุชุฎุฏู (User ID)</label>
          <input type="text" id="login-username" placeholder="Username..." class="pro-input ltr-input" />
        </div>

        <button class="pro-btn primary-btn" onclick="loginUser()">ุฏุฎูู ููุณูุณุชู ๐</button>
      </div>

      <!-- ูุญุชูู ุงูุญุณุงุจ ุงูุฌุฏูุฏ -->
      <div id="register-form" class="auth-content fade-in" style="display:none;">
        <div class="auth-header">
          <h3>ุงูุถู ูุฃุจุทุงู ุงูุชูุฑูุถ ๐</h3>
          <p>ุฃูุดุฆ ุญุณุงุจู ุงูุดุฎุตู ุงูุขู</p>
        </div>

        <div class="input-group">
          <label>ุงูุงุณู ุงูุซูุงุซู (ุจุงูุนุฑุจู)</label>
          <input type="text" id="reg-fullname" placeholder="ูุซุงู: ุฃุญูุฏ ูุญูุฏ ุนูู" class="pro-input" />
        </div>

        <div class="input-group">
          <label>ุงุฎุชุฑ ุงุณู ูุณุชุฎุฏู (ุฅูุฌููุฒู)</label>
          <input type="text" id="reg-username" placeholder="ex: ahmed99" class="pro-input ltr-input" />
          <small class="hint-text">ุญุฑูู ุฅูุฌููุฒูุฉ ูุฃุฑูุงู ููุท (ุจุฏูู ูุณุงูุงุช)</small>
        </div>

        <button class="pro-btn success-btn" onclick="registerUser()">ุฅูุดุงุก ุงูุญุณุงุจ โ</button>
      </div>
      
      <p id="auth-error" class="error-msg"></p>

    </div>
  </div>

  <!-- Admin Login -->
  <div id="admin-login-modal" class="modal-overlay" style="display: none;">
    <div class="modal-box admin-box">
      <div class="auth-header">
        <h2>ุฏุฎูู ุงููุดุฑููู ๐</h2>
        <p>ููุทูุฉ ูุญุธูุฑุฉ ุฅูุง ูููุณุคูููู</p>
      </div>
      <input type="password" id="admin-password-input" placeholder="ูููุฉ ุงููุฑูุฑ..." class="pro-input ltr-input" />
      <div class="modal-buttons">
          <button class="pro-btn primary-btn" onclick="checkAdminPassword()">ุฏุฎูู</button>
          <button class="pro-btn secondary-btn" onclick="closeAdminLogin()">ุฅูุบุงุก</button>
      </div>
    </div>
  </div>

  <!-- Main Container -->
  <div class="container">
    <div class="header">
      <div class="header-controls">
          <button id="theme-toggle" class="icon-btn" title="ุชุบููุฑ ุงููุถุน">๐</button>
          <button onclick="logout()" class="icon-btn logout-icon" title="ุชุณุฌูู ุฎุฑูุฌ">๐ช</button>
          <button onclick="openDashboard()" class="icon-btn dashboard-icon" title="ุฅุญุตุงุฆูุงุชู">๐</button>
          <button onclick="checkAdminSession()" class="icon-btn admin-icon" title="ููุญุฉ ุงููุดุฑููู">๐จโ๐ผ</button>
      </div>
      
      <h1 id="site-title">ููุตุฉ ุงูุงุฎุชุจุงุฑุงุช</h1>
      <p id="welcome-message">ุฃููุงู ุจู</p>
    </div>

    <!-- Leaderboard -->
    <div id="leaderboard-section" class="leaderboard-container" style="display:none;">
        <h3>๐ ููุญุฉ ุงูุดุฑู - ุงูุฃูุงุฆู ๐</h3>
        <div id="leaderboard-list" class="leaderboard-grid"></div>
    </div>

    <!-- Navigation & Content -->
    <div id="main-nav" class="tab-container"></div>
    <div id="source-selection" class="source-container"></div>
    
    <div id="quiz-list-area" class="tab-content active" style="display:none;">
        <button class="back-btn" onclick="backToSources()">โ ุชุบููุฑ ุงููุตุฏุฑ</button>
        <h3 id="source-title-display" style="text-align:center; color:var(--primary-color); margin-bottom:20px;"></h3>
        <div id="dynamic-cards-container" class="cards-grid"></div>
    </div>

    <!-- Student Dashboard -->
    <div id="dashboard-view" class="dashboard-view" style="display:none;">
        <h2 class="quiz-title">ุฅุญุตุงุฆูุงุชู ุงูุดุฎุตูุฉ ๐</h2>
        <div class="stats-grid">
            <div class="stat-card"><div class="stat-icon">๐</div><div class="stat-info"><span id="total-quizzes-taken">0</span><p>ูููุฒุงุช</p></div></div>
            <div class="stat-card"><div class="stat-icon">๐ฏ</div><div class="stat-info"><span id="total-accuracy">0%</span><p>ุงูุฏูุฉ</p></div></div>
            <div class="stat-card"><div class="stat-icon">๐</div><div class="stat-info"><span id="total-attempts">0</span><p>ูุญุงููุงุช</p></div></div>
        </div>
        <div class="history-table-container">
            <table id="history-table">
                <thead><tr><th>ุงูุงูุชุญุงู</th><th>ุฃุนูู ุฏุฑุฌุฉ</th><th>ุขุฎุฑ ุฏุฑุฌุฉ</th><th>ุงููุญุงููุงุช</th></tr></thead>
                <tbody id="history-table-body"></tbody>
            </table>
        </div>
        <button class="pro-btn secondary-btn" onclick="closeDashboard()" style="margin-top:20px;">ุงูุนูุฏุฉ ููุฑุฆูุณูุฉ</button>
    </div>

    <!-- Admin Dashboard -->
    <div id="admin-dashboard-view" class="dashboard-view" style="display:none;">
        <div class="admin-header-flex">
            <h2 class="quiz-title" style="color:var(--secondary-color);">๐จโ๐ผ ููุญุฉ ุงูุชุญูู</h2>
            <button class="pro-btn secondary-btn" onclick="adminLogout()" style="width:auto;">ุชุณุฌูู ุฎุฑูุฌ</button>
        </div>

        <div class="tab-container center-tabs">
            <button class="tab-btn active" onclick="switchAdminTab('results')">๐ ุงููุชุงุฆุฌ ูุงูุชูุงุฑูุฑ</button>
            <button class="tab-btn" onclick="switchAdminTab('users')">๐ฅ ุฅุฏุงุฑุฉ ุงูุทูุงุจ</button>
            <button class="tab-btn" onclick="switchAdminTab('content')">๐ ุฅุถุงูุฉ ุงูุชุญุงู</button>
            <button class="tab-btn" onclick="switchAdminTab('settings')">โ๏ธ ุงูุฅุนุฏุงุฏุงุช</button>
        </div>

        <!-- 1. Results & Reports -->
        <div id="admin-tab-results" class="admin-tab-content">
            <div class="filter-container">
                <input type="text" id="results-search" placeholder="ุงุจุญุซ ุจุงุณู ุงูุทุงูุจ ุฃู ุงูููุฒุฑ..." onkeyup="filterResults()" class="search-box pro-input">
                <div class="action-buttons">
                    <button class="pro-btn primary-btn sm" onclick="fetchGroupedResults()">๐ ุชุญุฏูุซ</button>
                    <button class="pro-btn success-btn sm" onclick="printAllReports()">๐จ๏ธ ุทุจุงุนุฉ ุงููู</button>
                    <button class="pro-btn success-btn sm" onclick="exportGroupedExcel()">๐ฅ Excel ุดุงูู</button>
                </div>
            </div>
            
            <div id="results-accordion-container" class="accordion-container">
                <p style="text-align:center; padding:20px; color:#666;">ุฌุงุฑู ุชุญููู ุงูุจูุงูุงุช...</p>
            </div>
        </div>

        <!-- 2. Users Management -->
        <div id="admin-tab-users" class="admin-tab-content" style="display:none;">
            <div class="filter-container">
                <input type="text" id="users-search" placeholder="ุงุจุญุซ ุนู ุทุงูุจ..." onkeyup="filterUsersTable()" class="search-box pro-input">
                <button class="pro-btn primary-btn sm" onclick="fetchAdminUsers()">๐ ุชุญุฏูุซ</button>
            </div>
            <div class="history-table-container">
                <table id="users-table">
                    <thead><tr><th>ุงูุงุณู</th><th>User ID</th><th>ุชุงุฑูุฎ ุงูุงูุถูุงู</th><th>ุงูุญุงูุฉ</th><th>ุฅุฌุฑุงุกุงุช</th></tr></thead>
                    <tbody id="users-table-body"></tbody>
                </table>
            </div>
        </div>

        <!-- 3. Add Exam -->
        <div id="admin-tab-content" class="admin-tab-content" style="display:none;">
            <div class="review-question" style="background:white; border-color:#22c55e;">
                <h3>ุจูุงูุงุช ุงูุงูุชุญุงู ุงูุฃุณุงุณูุฉ</h3>
                <div class="form-grid">
                    <select id="exam-subject-select" onchange="updateSourceSelect()" class="pro-input"></select>
                    <select id="exam-source-select" class="pro-input"></select>
                    <input type="text" id="new-exam-title" placeholder="ุนููุงู ุงูุงูุชุญุงู (ูุซุงู: Quiz 1)..." class="pro-input">
                </div>
                
                <div class="settings-group">
                    <h4>๐ ุงูููุช ูุงูุฎุตุงุฆุต</h4>
                    <div class="form-grid">
                        <input type="number" id="new-exam-time" placeholder="ุงููุฏุฉ (ุฏ) - 0 ููุชูุญ" class="pro-input">
                        <div class="check-wrap"><input type="checkbox" id="opt-one-attempt"> <span>ูุฑุฉ ูุงุญุฏุฉ</span></div>
                        <div class="check-wrap"><input type="checkbox" id="opt-random-q"> <span>ุฃุณุฆูุฉ ุนุดูุงุฆูุฉ</span></div>
                        <div class="check-wrap"><input type="checkbox" id="opt-hide-result"> <span>ุฅุฎูุงุก ุงููุชูุฌุฉ</span></div>
                    </div>
                </div>

                <div class="smart-paste-area">
                    <h4>โก ุงูุงุณุชูุฑุงุฏ ุงูุฐูู (Smart Paste)</h4>
                    <p class="hint-text">ุงูุณุฎ ุงูุฃุณุฆูุฉ ูู Word/PDF (ุฅูุฌููุฒู) ูุถุนูุง ููุง. ุงูุตูุบ ุงููุฏุนููุฉ: <code>1. / Q1. / a) / *Correct</code></p>
                    <textarea id="smart-paste-input" rows="6" placeholder="Example:&#10;1. What is the capital of Egypt?&#10;a) Cairo&#10;b) Alex&#10;*c) Giza" class="ltr-input pro-input"></textarea>
                    <button class="pro-btn secondary-btn" onclick="parseSmartPaste()" style="margin-top:10px;">๐ช ุชุญููู ููุฑูุช</button>
                </div>

                <div id="visual-editor-container"></div>
                
                <button class="pro-btn success-btn" onclick="saveExamFinal()" style="margin-top:20px; width:100%;">๐พ ุญูุธ ุงูุงูุชุญุงู</button>
            </div>

            <div class="review-question" style="margin-top:20px;">
                <details>
                    <summary>โ ุฅุถุงูุฉ ูุงุฏุฉ ุฃู ูุตุฏุฑ ุฌุฏูุฏ</summary>
                    <div class="form-grid" style="margin-top:10px;">
                        <input type="text" id="new-subject-name" placeholder="ุงุณู ุงููุงุฏุฉ" class="pro-input">
                        <input type="text" id="new-subject-id" placeholder="ID" class="pro-input">
                        <button onclick="addNewSubject()" class="pro-btn primary-btn sm">ุฅุถุงูุฉ ูุงุฏุฉ</button>
                    </div>
                    <div class="form-grid" style="margin-top:10px;">
                        <select id="source-subject-select" class="pro-input"></select>
                        <input type="text" id="new-source-name" placeholder="ุงุณู ุงููุตุฏุฑ" class="pro-input">
                        <input type="text" id="new-source-id" placeholder="Source ID" class="pro-input">
                        <button onclick="addNewSource()" class="pro-btn primary-btn sm">ุฅุถุงูุฉ ูุตุฏุฑ</button>
                    </div>
                </details>
            </div>
        </div>

        <!-- 4. Settings -->
        <div id="admin-tab-settings" class="admin-tab-content" style="display:none;">
            <div class="admin-setting-card">
                <h3>๐ข ุฅุนูุงูุงุช ุงูููุตุฉ</h3>
                <textarea id="announcement-input" rows="2" placeholder="ุงูุชุจ ุงูุชูุจูู ููุง ููุธูุฑ ููุทูุงุจ..." class="pro-input"></textarea>
                <div class="action-buttons" style="margin-top:10px;">
                    <button onclick="saveAnnouncement()" class="pro-btn primary-btn sm">ูุดุฑ ุงูุฅุนูุงู</button>
                    <button onclick="clearAnnouncement()" class="pro-btn danger-btn sm">ุฅูุบุงุก ุงูุฅุนูุงู</button>
                </div>
            </div>

            <div class="admin-setting-card">
                <h3>โ๏ธ ุงูุฎุตุงุฆุต</h3>
                <label class="switch-container">
                    <input type="checkbox" id="leaderboard-toggle" onchange="updateConfigSettings()">
                    <span class="slider round"></span>
                    <span class="switch-text">ุชูุนูู ููุญุฉ ุงูุดุฑู (Leaderboard)</span>
                </label>
            </div>
        </div>
    </div>

    <!-- Quiz & Results Views -->
    <div id="quiz-container" class="quiz-container">
      <div class="quiz-header">
        <h2 id="current-quiz-title" class="quiz-title"></h2>
        <div class="progress-bar"><div id="progress-fill" class="progress-fill"></div></div>
        <p id="question-counter"></p>
        <div id="quiz-timer" class="timer-badge">00:00</div>
      </div>
      <div id="question-container"></div>
      <div class="quiz-navigation">
        <button id="prev-btn" class="nav-btn" disabled>ุงูุณุงุจู</button>
        <button id="next-btn" class="nav-btn">ุงูุชุงูู</button>
      </div>
    </div>

    <div id="results" class="quiz-container results">
      <h3>ุงูุชูู ุงูุงุฎุชุจุงุฑ!</h3>
      <div id="final-score" class="score"></div>
      <p id="score-message"></p>
      <button id="review-btn" class="pro-btn primary-btn">ูุฑุงุฌุนุฉ ุงูุฅุฌุงุจุงุช</button>
      <button class="pro-btn secondary-btn" onclick="backToQuizList()">ุงูุนูุฏุฉ ูููุงุฆูุฉ</button>
    </div>

    <div id="review-container" class="review-container">
      <h2 class="quiz-title">ูุฑุงุฌุนุฉ ุงูุฅุฌุงุจุงุช</h2>
      <button class="back-btn" id="back-to-results">โ ุงูุนูุฏุฉ ูููุชุงุฆุฌ</button>
      <div id="review-content"></div>
      <button class="pro-btn secondary-btn" onclick="backToQuizList()">ุงูุนูุฏุฉ ูููุงุฆูุฉ</button>
    </div>

    <div class="footer">
      <p>Created by Zyad & Yusuf</p>
      <a href="https://zyadyasser2007.sarhne.com" target="_blank" class="sarhne-btn">ุตุงุฑุญูู ๐โค๏ธ</a>
    </div>
  </div>

  <!-- Print Area -->
  <div id="print-area"></div>

  <script src="script.js"></script>
</body>
</html>


